<html><head><link rel="import" href="../bower_components/polymer/polymer.html"><link rel="import" href="../bower_components/paper-input/paper-input.html"><link rel="import" href="../bower_components/paper-card/paper-card.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../bower_components/iron-icon/iron-icon.html"><link rel="import" href="../bower_components/iron-icons/iron-icons.html"><link rel="import" href="../bower_components/iron-icons/social-icons.html"><link rel="import" href="../bower_components/iron-icons/communication-icons.html"><link rel="import" href="../bower_components/paper-styles/typography.html"><link rel="import" href="../bower_components/iron-form/iron-form.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="view-redirect"><template><style include="shared-styles iron-flex">:host{display:block;padding:10px;--paper-input-container-focus-color:var(--app-primary-color);--paper-input-container-invalid-color:red;}</style><iron-localstorage name="blinkboxToken" value="{{ token }}" useraw="true" on-iron-localstorage-load-empty="initializeDefaultToken"></iron-localstorage><iron-localstorage name="blinkboxUser" value="{{ user }}" on-iron-localstorage-load-empty="initializeDefaultUser" on-iron-localstorage-load="localStorageLoad"></iron-localstorage><iron-ajax id="permissions" url="[[ backendUrl ]]/files/sharedWith/[[ user.email ]]" method="GET" content-type="application/x-www-form-urlencoded" handle-as="json" on-response="permissionsResponse" on-error="permissionsError"></iron-ajax></template><script>Polymer({is:'view-redirect',ready:function(){this.backendURL=this.backendUrl,this.sharedID=this.queryParams.id},localStorageLoad:function(){''===this.user.email?location.pathname='/not-logged':(this.$.permissions.headers.Authorization='Bearer '+this.token,this.$.permissions.generateRequest())},initializeDefaultToken:function(){this.token=''},initializeDefaultUser:function(){this.user={id:'',firstName:'',lastName:'',email:'',exp_date:''}},permissionsError:console.error,permissionsResponse:function(a){var b=a.detail.response;if(b.shared_documents)for(var c=b.shared_documents,d=0;d<c.length;d++)if(c[d]._id===this.sharedID)return void(location.pathname='/shared');this.fire('iron-signal',{name:'message-dialog',data:{error:'No tienes accesso al archivo',redirect:'/index'}})}});</script></dom-module></body></html>
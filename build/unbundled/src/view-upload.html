<html><head><link rel="import" href="../bower_components/polymer/polymer.html"><link rel="import" href="../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../bower_components/vaadin-grid/vaadin-grid.html"><link rel="import" href="../bower_components/vaadin-date-picker/vaadin-date-picker.html"><link rel="import" href="custom-vaadin-upload/vaadin-upload.html"><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html"><link rel="import" href="../bower_components/iron-localstorage/iron-localstorage.html"><link rel="import" href="../bower_components/paper-dialog/paper-dialog.html"><link rel="import" href="shared-styles.html"></head><body><dom-module id="view-upload"><template><style include="shared-styles iron-flex">:host{display:block;padding:10px;}@media screen and (min-width: 769px){.container{width:75%;}}.container{display:block;margin-left:auto;margin-right:auto;background-color:#fff;}.button-block{@apply (--layout-horizontal);@apply (--layout-center-justified);padding-bottom:10px;}.block{width:90%;display:block;margin-left:auto;margin-right:auto;padding:5px;}paper-button{background-color:var(--app-primary-color);color:white;}vaadin-upload{border:dashed 1px lightgray;}</style><paper-card><iron-localstorage name="blinkboxToken" value="{{token}}" useraw="true" on-iron-localstorage-load="loadStorage"></iron-localstorage><iron-localstorage name="blinkboxUser" value="{{user}}" useraw="true" on-iron-localstorage-load="loadStorage"></iron-localstorage><div class="container"><div class="block"><vaadin-upload no-auto="" id="uploadFile" target="[[backendURL]]/files/upload/[[user.email]]" max-files="1" on-upload-request="handleRequest" on-upload-success="success"></vaadin-upload></div><div class="block"><vaadin-date-picker label="Disponible hasta" id="datePicker" value="[[now()]]" min="[[now()]]" max="[[maxDate()]]" required=""></vaadin-date-picker></div><div class="block"><p style="color: #737373">Compartir con</p><vaadin-grid items="[[emails]]" id="sharedEmails"><vaadin-grid-column><template class="header">Email</template><template>[[item]]</template><template class="footer"><paper-input label="Añadir correo" auto-validate="" type="email" style="padding-bottom: 12px" error-message="Por favor ingrese un email válido" on-keypress="addEmail"></paper-input></template></vaadin-grid-column></vaadin-grid></div><div class="button-block" style="padding-top: 20px"><paper-button on-tap="handleTap" raised="">Enviar</paper-button></div></div></paper-card><paper-dialog id="successDialog"><h3>El archivo ha sido subido exitosamente</h3><div class="buttons"><a href="/owned" tabindex="-1"><paper-button dialog-dismiss="">Cerrar</paper-button></a></div></paper-dialog></template><script>Polymer({is:'view-upload',properties:{emails:{type:Array,value:[]},backendURL:String,user:Object},ready:function(){this.backendURL=this.backendUrl},addEmail:function(a){if(a.target.validate()&&13===a.charCode){var b=a.target.value;this.emails.push(b),this.notifyPath('emails'),a.target.value='',this.$.sharedEmails.clearCache()}},handleRequest:function(a){var b=new Date(this.$.datePicker.value);if(b.setHours(0),b.setMinutes(0),b.setSeconds(0),b.setMilliseconds(0),a.detail.formData.append('expiring_date',b.getTime()/1e3),0<this.$.sharedEmails.items.length){var c=this.$.sharedEmails.items.join(',');a.detail.formData.append('shared',c)}},now:function(){var a=new Date;return a.toISOString().split('T')[0]},maxDate:function(){var a=new Date;return a.setDate(a.getDate()+7),a.toISOString().split('T')[0]},handleTap:function(){this.$.uploadFile.uploadFiles()},success:function(){this.$.successDialog.toggle()},loadStorage:function(){0===this.token.length&&(location.href='/not-logged'),this.$.uploadFile.headers.Authorization='Bearer '+this.token}});</script></dom-module></body></html>
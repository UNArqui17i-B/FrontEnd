<html><head><link rel="import" href="../iron-form-element-behavior/iron-form-element-behavior.html"><link rel="import" href="../iron-a11y-announcer/iron-a11y-announcer.html"><link rel="import" href="vaadin-dropdown-behavior.html"><script>window.vaadin=window.vaadin||{},vaadin.elements=vaadin.elements||{},vaadin.elements.combobox=vaadin.elements.combobox||{},vaadin.elements.combobox.ComboBoxBehaviorImpl={properties:{items:{type:Array},allowCustomValue:{type:Boolean,value:!1},filteredItems:{type:Array},value:{type:String,observer:'_valueChanged',notify:!1},_lastCommittedValue:String,hasValue:{type:Boolean,value:!1,readOnly:!0,reflectToAttribute:!0},loading:{type:Boolean,value:!1},_focusedIndex:{type:Number,value:-1},filter:{type:String,value:'',notify:!0},selectedItem:{type:Object,notify:!0,value:function(){return null}},itemLabelPath:{type:String,value:'label'},itemValuePath:{type:String,value:'value'},inputElement:{type:HTMLElement,readOnly:!0},_toggleElement:Object,_clearElement:Object,_inputElementValue:String,_closeOnBlurIsPrevented:Boolean,_templatized:Boolean,_itemTemplate:Boolean,_previousDocumentPointerEvents:String},observers:['_filterChanged(filter, itemValuePath, itemLabelPath)','_itemsChanged(items.*, itemValuePath, itemLabelPath)','_filteredItemsChanged(filteredItems.*, itemValuePath, itemLabelPath)','_loadingChanged(loading)','_selectedItemChanged(selectedItem)'],listeners:{'vaadin-dropdown-opened':'_onOpened','vaadin-dropdown-closed':'_onClosed',keydown:'_onKeyDown',tap:'_onTap','overlay.selection-changed':'_overlaySelectedItemChanged'},ready:function(){this.value===void 0&&(this.value=''),this._lastCommittedValue=this.value,Polymer.IronA11yAnnouncer.requestAvailability()},_onBlur:function(){this._closeOnBlurIsPrevented||this.close()},_onOverlayDown:function(a){this.$.overlay.touchDevice&&a.target!==this.$.overlay.$.scroller&&(this._closeOnBlurIsPrevented=!0,this.inputElement.blur(),this._closeOnBlurIsPrevented=!1)},_onTap:function(a){this._closeOnBlurIsPrevented=!0;var b=Polymer.dom(a).path;-1===b.indexOf(this._clearElement)?-1===b.indexOf(this._toggleElement)?-1!==b.indexOf(this.inputElement)&&this._openAsync():this._toggle():this._clear(),this._closeOnBlurIsPrevented=!1},_onKeyDown:function(a){this._isEventKey(a,'down')?(this._closeOnBlurIsPrevented=!0,this._onArrowDown(),this._closeOnBlurIsPrevented=!1,a.preventDefault()):this._isEventKey(a,'up')?(this._closeOnBlurIsPrevented=!0,this._onArrowUp(),this._closeOnBlurIsPrevented=!1,a.preventDefault()):this._isEventKey(a,'enter')?this._onEnter(a):this._isEventKey(a,'esc')&&this._onEscape()},_isEventKey:function(a,b){return Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(a,b)},_getItemLabel:function(a){return this.$.overlay.getItemLabel(a)},_getItemValue:function(a){var b=a?this.get(this.itemValuePath,a):void 0;return void 0===b&&(b=a?a.toString():''),b},_onArrowDown:function(){this.opened?this.$.overlay._items&&(this._focusedIndex=Math.min(this.$.overlay._items.length-1,this._focusedIndex+1),this._prefillFocusedItemLabel()):this.open()},_onArrowUp:function(){this.opened?(-1<this._focusedIndex?this._focusedIndex=Math.max(0,this._focusedIndex-1):this.$.overlay._items&&(this._focusedIndex=this.$.overlay._items.length-1),this._prefillFocusedItemLabel()):this.open()},_prefillFocusedItemLabel:function(){-1<this._focusedIndex&&(this._inputElementValue='',this.async(function(){this._inputElementValue=this._getItemLabel(this.$.overlay._focusedItem),this._setSelectionRange()},1))},_setSelectionRange:function(){this.inputElement.setSelectionRange&&this.inputElement.setSelectionRange(0,this._inputElementValue.length)},_onEnter:function(a){this.opened&&(this.allowCustomValue||''===this._inputElementValue||-1<this._focusedIndex)&&(this.close(),a.preventDefault())},_onEscape:function(){this.opened&&(-1<this._focusedIndex?(this._focusedIndex=-1,this._revertInputValue()):this.cancel())},_openAsync:function(){this.async(this.open)},_toggle:function(){this.opened?this.close():this.open()},_clear:function(){this.selectedItem=null,this.allowCustomValue&&(this.value=''),this.opened?this.close():this._detectAndDispatchChange()},cancel:function(){this._revertInputValueToValue(),this._lastCommittedValue=this.value,this.close()},_onOpened:function(){this.$.overlay.hidden=!this._hasItems(this.$.overlay._items)&&!this.loading,this.$.overlay.ensureItemsRendered(),this.$.overlay.updateViewportBoundaries(),this.$.overlay.async(this.$.overlay.adjustScrollPosition),this.$.overlay.async(this.$.overlay.notifyResize,1),this._previousDocumentPointerEvents=document.body.style.pointerEvents,document.body.style.pointerEvents='none',this._lastCommittedValue=this.value},_onClosed:function(){if(-1<this._focusedIndex){var a=this.$.overlay._items[this._focusedIndex];this.selectedItem!==a&&(this.selectedItem=a),this._inputElementValue=this._getItemLabel(this.selectedItem)}else if(''===this._inputElementValue)this._clear();else if(this.allowCustomValue){var b=this.fire('custom-value-set',this._inputElementValue,{cancelable:!0});if(!b.defaultPrevented){var c=this._inputElementValue;this.selectedItem=null,this.value=c}}else this._inputElementValue=this._getItemLabel(this.selectedItem);this._detectAndDispatchChange(),this._clearSelectionRange(),this.filter='',document.body.style.pointerEvents=this._previousDocumentPointerEvents},_inputValueChanged:function(a){-1!==Polymer.dom(a).path.indexOf(this.inputElement)&&(this.filter===this._inputElementValue?this._filterChanged(this.filter):(this._userDefinedFilter=!0,this.filter=this._inputElementValue,this._userDefinedFilter=!1),!this.opened&&this.open())},_clearSelectionRange:function(){if(document.activeElement===this.inputElement&&this.inputElement.setSelectionRange){var a=this._inputElementValue?this._inputElementValue.length:0;this.inputElement.setSelectionRange(a,a)}},_filterChanged:function(a){this.items&&(this.filteredItems=this._filterItems(this.items,a))},_loadingChanged:function(a){a&&(this._focusedIndex=-1)},_revertInputValue:function(){''===this.filter?this._revertInputValueToValue():this._inputElementValue=this.filter,this._clearSelectionRange()},_revertInputValueToValue:function(){this._inputElementValue=this.allowCustomValue&&!this.selectedItem?this.value:this._getItemLabel(this.selectedItem)},_selectedItemChanged:function(a){if(this.filteredItems){if(null===a)this.allowCustomValue||(this.value=''),this._setHasValue(''!==this.value),this._inputElementValue=this.value;else{var b=this._getItemValue(a);this.value!==b&&(this.value=b),this._setHasValue(!0),this._inputElementValue=this._getItemLabel(a)}this.$.overlay._selectedItem=a,this._focusedIndex=this.filteredItems.indexOf(a)}},_valueChanged:function(a){if(this._isValidValue(a)){if(this._getItemValue(this.selectedItem)!==a){var b=this._indexOfValue(a,this.filteredItems);this.selectedItem=0<=b?this.filteredItems[b]:null}else var c=this.selectedItem;!c&&this.allowCustomValue&&(this._inputElementValue=a),this._setHasValue(''!==this.value)}else this.selectedItem=null;this._lastCommittedValue=void 0},_detectAndDispatchChange:function(){this.value!==this._lastCommittedValue&&(this.fire('change',void 0,{bubbles:!0}),this._lastCommittedValue=this.value)},_itemsChanged:function(a){if('items'===a.path||'items.splices'===a.path){this.filteredItems=this.items?this.items.slice(0):this.items;var b=this._indexOfValue(this.value,this.items);this._focusedIndex=b;var c=-1<b&&this.items[b];c&&(this.selectedItem=c)}},_filteredItemsChanged:function(a){('filteredItems'===a.path||'filteredItems.splices'===a.path)&&(this._setOverlayItems(this.filteredItems),this._focusedIndex=this.opened||this._userDefinedFilter?this.$.overlay.indexOfLabel(this.filter):this._indexOfValue(this.value,this.filteredItems),this.async(function(){this.$.overlay.notifyResize()},1))},_filterItems:function(a,b){return a?a.filter(function(c){return b=b?b.toString().toLowerCase():'',-1<this._getItemLabel(c).toString().toLowerCase().indexOf(b)}.bind(this)):a},_setOverlayItems:function(a){this.$.overlay.notifyPath('_items',void 0),this.$.overlay.set('_items',a),this.$.overlay.hidden=!this._hasItems(a),this.$.overlay.notifyResize()},_hasItems:function(a){return a&&a.length},_indexOfValue:function(a,b){if(b&&this._isValidValue(a))for(var c=0;c<b.length;c++)if(this._getItemValue(b[c])===a)return c;return-1},_isValidValue:function(a){return a!==void 0&&null!==a},_overlaySelectedItemChanged:function(a,b){this.selectedItem!==b.item&&(this.selectedItem=b.item),this.opened&&this.close(),a.stopPropagation()},_getValidity:function(){if(this.inputElement.validate)return this.inputElement.validate()},get _instanceProps(){return{item:!0,index:!0,selected:!0,focused:!0}},_ensureTemplatized:function(){this._templatized||(this._templatized=!0,this._itemTemplate=Polymer.dom(this).querySelector('template'),this._itemTemplate&&this.templatize(this._itemTemplate))},_forwardParentProp:function(a,b){var c=this.$.overlay.$.selector.querySelectorAll('vaadin-combo-box-item');Array.prototype.forEach.call(c,function(d){d._itemTemplateInstance[a]=b})},_forwardParentPath:function(a,b){var c=this.$.overlay.$.selector.querySelectorAll('vaadin-combo-box-item');Array.prototype.forEach.call(c,function(d){d._itemTemplateInstance.notifyPath(a,b,!0)})},_preventInputBlur:function(){this._toggleElement&&this.listen(this._toggleElement,'down','_preventDefault'),this._clearElement&&this.listen(this._clearElement,'down','_preventDefault')},_restoreInputBlur:function(){this._toggleElement&&this.unlisten(this._toggleElement,'down','_preventDefault'),this._clearElement&&this.unlisten(this._clearElement,'down','_preventDefault')},_preventDefault:function(a){a.preventDefault()},_stopPropagation:function(a){a.stopPropagation()}},vaadin.elements.combobox.ComboBoxBehavior=[Polymer.IronFormElementBehavior,Polymer.Templatizer,vaadin.elements.combobox.DropdownBehavior,vaadin.elements.combobox.ComboBoxBehaviorImpl];</script></head><body></body></html>
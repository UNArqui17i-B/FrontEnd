<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-list/iron-list.html"><link rel="import" href="../paper-styles/shadow.html"><link rel="import" href="vaadin-overlay-behavior.html"><link rel="import" href="vaadin-combo-box-item.html"><link rel="import" href="vaadin-spinner.html"></head><body><dom-module id="vaadin-combo-box-overlay"><template><style>:host{position:absolute;@apply (--shadow-elevation-2dp);background:#fff;border-radius:0 0 2px 2px;top:0;left:0;pointer-events:auto;z-index:200;overflow:hidden;}#scroller{overflow:auto;max-height:var(--vaadin-combo-box-overlay-max-height, 65vh);transform:translate3d(0, 0, 0);-webkit-overflow-scrolling:touch;}#selector{--iron-list-items-container:{border-top:8px solid transparent;border-bottom:8px solid transparent;};}#selector vaadin-combo-box-item{cursor:pointer;padding:13px 16px;color:var(--primary-text-color);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}:host([opened][loading]){display:block !important;height:58px;}#selector:not([touch-device]) vaadin-combo-box-item:hover,
      #selector vaadin-combo-box-item[focused]{background:#eee;}#selector vaadin-combo-box-item[selected]{color:var(--primary-color);}</style><vaadin-spinner active="[[loading]]"></vaadin-spinner><div id="scroller" scroller="[[_getScroller()]]" on-tap="_stopPropagation" on-touchstart="_onTouchStart" on-touchend="_preventDefault" on-scroll="_onScroll" hidden$="[[loading]]"><iron-list id="selector" touch-device$="[[touchDevice]]" role="listbox" items="[[_items]]" scroll-target="[[_getScroller()]]"><template><vaadin-combo-box-item on-tap="_onTap" index="[[index]]" item="[[item]]" label="[[getItemLabel(item)]]" selected="[[_isItemSelected(item, _selectedItem)]]" role$="[[_getAriaRole(index)]]" aria-selected$="[[_getAriaSelected(_focusedIndex,index)]]" focused="[[_isItemFocused(_focusedIndex,index)]]"></vaadin-combo-box-item></template></iron-list></div></template></dom-module><script>Polymer({is:'vaadin-combo-box-overlay',behaviors:[vaadin.elements.combobox.OverlayBehavior],properties:{touchDevice:{type:Boolean,reflectToAttribute:!0,value:function(){try{return document.createEvent('TouchEvent'),!0}catch(a){return!1}}},loading:{type:Boolean,value:!1,reflectToAttribute:!0,observer:'notifyResize'},_selectedItem:{type:Object},_items:{type:Object},_focusedIndex:{type:Number,notify:!0,value:-1,observer:'_focusedIndexChanged'},_focusedItem:{type:String,computed:'_getFocusedItem(_focusedIndex)'},_itemLabelPath:{type:String,value:'label'},_itemValuePath:{type:String,value:'value'},_notTapping:Boolean,_ignoreTaps:Boolean},ready:function(){this._patchWheelOverScrolling(),this.$.selector._scroller!==void 0&&(this.$.selector._scroller=this._getScroller())},_getFocusedItem:function(a){if(0<=a)return this._items[a]},_isItemSelected:function(a,b){return a===b},_onTap:function(a){this._notTapping||this._ignoreTaps||this.fire('selection-changed',{item:a.model.item})},_onTouchStart:function(){this._notTapping=!1,this.async(function(){this._notTapping=!0},300)},_onScroll:function(){this._ignoreTaps=!0,this.debounce('restore-taps',function(){this._ignoreTaps=!1},300)},indexOfLabel:function(a){if(this._items&&a)for(var b=0;b<this._items.length;b++)if(this.getItemLabel(this._items[b]).toString().toLowerCase()===a.toString().toLowerCase())return b;return-1},getItemLabel:function(a){var b=a?this.get(this._itemLabelPath,a):void 0;return void 0===b&&(b=a?a.toString():''),b},_isItemFocused:function(a,b){return a==b},_getAriaSelected:function(a,b){return this._isItemFocused(a,b).toString()},_getAriaRole:function(a){return a!==void 0&&'option'},_focusedIndexChanged:function(a){0<=a&&this._scrollIntoView(a)},_scrollIntoView:function(a){var b=this._visibleItemsCount();if(void 0!==b){var c=a;a>this.$.selector.lastVisibleIndex-1?c=a-b+1:a>this.$.selector.firstVisibleIndex&&(c=this.$.selector.firstVisibleIndex),this.$.selector.scrollToIndex(Math.max(0,c));var d=this._items[a];if(void 0!==d){var f=this.$.selector._getPhysicalIndex(d),g=this.$.selector._physicalItems[f];if(g){var h=g.getBoundingClientRect(),j=this.$.scroller.getBoundingClientRect(),k=h.bottom-j.bottom+this._viewportTotalPaddingBottom;0<k&&(this.$.scroller.scrollTop+=k)}}}},ensureItemsRendered:function(){this.$.selector.flushDebouncer('_debounceTemplate')},adjustScrollPosition:function(){this._items&&this._scrollIntoView(this._focusedIndex)},_getScroller:function(){return this.$.scroller},_patchWheelOverScrolling:function(){var a=this.$.selector;a.addEventListener('wheel',function(b){var c=a._scroller||a.scrollTarget,d=0===c.scrollTop,f=1>=c.scrollHeight-c.scrollTop-c.clientHeight;d&&0>b.deltaY?b.preventDefault():f&&0<b.deltaY&&b.preventDefault()})},updateViewportBoundaries:function(){this._cachedViewportTotalPaddingBottom=void 0,this.$.selector.updateViewportBoundaries()},get _viewportTotalPaddingBottom(){if(this._cachedViewportTotalPaddingBottom===void 0){var a=window.getComputedStyle(this._unwrapIfNeeded(this.$.selector.$.items));this._cachedViewportTotalPaddingBottom=[a.paddingBottom,a.borderBottomWidth].map(function(b){return parseInt(b,10)}).reduce(function(b,c){return b+c})}return this._cachedViewportTotalPaddingBottom},_visibleItemsCount:function(){return this.$.selector.flushDebouncer('_debounceTemplate'),this.$.selector.scrollToIndex(this.$.selector.firstVisibleIndex),this.updateViewportBoundaries(),this.$.selector.lastVisibleIndex-this.$.selector.firstVisibleIndex+1},_selectItem:function(a){a='number'===typeof a?this._items[a]:a,this.$.selector.selectedItem!==a&&this.$.selector.selectItem(a)},_preventDefault:function(a){a.cancelable&&a.preventDefault()},_stopPropagation:function(a){a.stopPropagation()}});</script></body></html>
<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../paper-styles/shadow.html"><link rel="import" href="../paper-styles/typography.html"><link rel="import" href="../iron-icon/iron-icon.html"><link rel="import" href="../iron-input/iron-input.html"><link rel="import" href="../paper-input/paper-input-container.html"><link rel="import" href="../iron-media-query/iron-media-query.html"><link rel="import" href="../paper-button/paper-button.html"><link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="import" href="../iron-a11y-announcer/iron-a11y-announcer.html"><link rel="import" href="vaadin-month-calendar.html"><link rel="import" href="vaadin-infinite-scroller.html"><link rel="import" href="vaadin-date-picker-helper.html"><link rel="import" href="vaadin-date-picker-icons.html"></head><body><dom-module id="vaadin-date-picker-overlay"><template><style>:host{display:flex;flex-direction:column;height:100%;width:100%;background:var(--primary-background-color);font:inherit;outline:none;@apply (--paper-font-common-base);@apply (--shadow-elevation-2dp);@apply (--vaadin-date-picker-overlay);}#toolbar{display:flex;justify-content:space-between;padding:14px;background:var(--primary-background-color);z-index:2;@apply (--paper-font-button);@apply (--shadow-elevation-2dp);flex-shrink:0;transform:translateZ(0);color:var(--primary-color);@apply (--vaadin-date-picker-toolbar);}#toolbar:not([desktop]){cursor:pointer;}#toolbar iron-icon{fill:var(--primary-color);padding:0;transition:transform 200ms;will-change:transform;--iron-icon-width:20px;--iron-icon-height:20px;@apply (--vaadin-date-picker-toolbar-icon);}#toolbar iron-icon[rotate]{transform:rotate(180deg);}#toolbar iron-icon[hidden]{display:none;}#scrollers{display:flex;flex-direction:row;height:100%;width:100%;position:relative;overflow:hidden;}#scrollers #fade{pointer-events:none;display:block;background:linear-gradient(90deg, var(--primary-background-color), rgba(255, 255, 255, 0));width:50px;position:absolute;height:100%;z-index:1;transform:translateX(-100%);@apply (--vaadin-date-picker-scrollers-fade);}#scrollers[desktop] #fade{display:none;}#scroller,
      #yearScroller{height:100%;}#scroller{padding:0 8px;position:absolute;top:0;left:0;right:0;bottom:0;}#scrollers[desktop] #scroller{right:50px;transform:none !important;}#yearScroller{text-align:center;width:50px;background:var(--dark-theme-background-color);color:var(--dark-theme-secondary-color);cursor:pointer;position:absolute;right:0;transform:translateX(100%);-webkit-tap-highlight-color:transparent;@apply (--paper-font-menu);@apply (--vaadin-date-picker-yearscroller);}#yearScroller div{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}#scrollers[desktop] #yearScroller{position:absolute;transform:none !important;}#yearScroller{--vaadin-infinite-scroller-buffer:{top:50%;margin-top:-12px;width:90px;};}#yearScroller::before{content:'';display:block;background:transparent;width:0;height:0;position:absolute;left:0;top:50%;margin-top:-6px;border-width:6px;border-style:solid;border-color:transparent;border-left-color:var(--primary-background-color);@apply (--vaadin-date-picker-yearscroller-indicator);}:host(.animate) vaadin-infinite-scroller{transition:all 200ms;}:host(:not([fullscreen])) #header{display:none;}#toolbar[desktop]{display:none;}#header{background:var(--primary-color);padding:0 14px 14px;display:flex;flex-shrink:0;height:64px;box-sizing:border-box;@apply (--paper-font-subhead);@apply (--shadow-elevation-2dp);@apply (--vaadin-date-picker-header);}#header label,
      #header input{color:var(--dark-theme-text-color);}#header iron-icon{color:var(--dark-theme-text-color);cursor:pointer;}#toggle{align-self:flex-end;}#header paper-input-container{flex:1;margin-right:24px;padding-bottom:0;--paper-input-container-underline:{display:none;};--paper-input-container-underline-focus:{display:block;background:var(--dark-theme-text-color);-webkit-transform:none;transform:none;};}#clear{display:none;}#clear[showclear]{display:flex;}#footer{display:flex;justify-content:space-between;padding:4px;@apply (--paper-font-body2);background:var(--primary-background-color);z-index:2;box-shadow:0 -1px 4px 0 rgba(0, 0, 0, 0.5);color:var(--primary-color);flex-shrink:0;@apply (--vaadin-date-picker-footer);}paper-button.keyboard-focus{color:var(--primary-background-color);background:var(--primary-color);outline:none;}#announcer{display:inline-block;position:fixed;clip:rect(0, 0, 0, 0);clip-path:inset(100%);}</style><div id="announcer" role="alert" aria-live="polite">[[i18n.calendar]]</div><div id="header" on-touchend="_preventDefault" aria-hidden="true"><paper-input-container><label>[[label]]</label><input id="input" readonly="" is="iron-input" autocomplete="off" bind-value="[[_formatDisplayed(selectedDate, i18n.formatDate)]]"><iron-icon id="clear" suffix="" on-tap="_clear" icon="vaadin-date-picker:clear" showclear$="[[_showClear(selectedDate)]]"></iron-icon></paper-input-container><iron-icon id="toggle" icon="vaadin-date-picker:event" on-tap="_cancel"></iron-icon></div><div id="toolbar" desktop$="[[_desktopMode]]" on-tap="_toggleYearScroller" aria-hidden="true">[[_yearAfterXMonths(_visibleMonthIndex)]]<iron-icon rotate$="[[_isYearScrollerVisible(_translateX)]]" icon="vaadin-date-picker:chevron-right"></iron-icon></div><div id="scrollers" desktop$="[[_desktopMode]]" on-track="_track"><div id="fade"></div><vaadin-infinite-scroller id="scroller" on-custom-scroll="_onMonthScroll" on-touchstart="_onMonthScrollTouchStart" item-height="250" buffer-size="6" active="[[initialPosition]]"><template><vaadin-month-calendar i18n="[[i18n]]" month="[[_dateAfterXMonths(index)]]" selected-date="{{selectedDate}}" focused-date="[[focusedDate]]" ignore-taps="[[_ignoreTaps]]" show-week-numbers="[[showWeekNumbers]]" min-date="[[minDate]]" max-date="[[maxDate]]" focused$="[[_focused]]"></vaadin-month-calendar></template></vaadin-infinite-scroller><vaadin-infinite-scroller id="yearScroller" on-tap="_onYearTap" on-custom-scroll="_onYearScroll" on-touchstart="_onYearScrollTouchStart" item-height="80" buffer-size="25" active="[[initialPosition]]"><template><div role="button">[[_yearAfterXYears(index)]]</div><div style="font-size: 18px; line-height: 56px; opacity: 0.3" aria-hidden="true">â€¢</div></template></vaadin-infinite-scroller></div><div id="footer" on-touchend="_preventDefault" role="toolbar"><paper-button id="todayButton" disabled="[[!_isTodayAllowed(minDate, maxDate)]]" on-tap="_onTodayTap">[[i18n.today]]</paper-button><paper-button id="cancelButton" on-tap="_cancel">[[i18n.cancel]]</paper-button></div><iron-media-query query="(min-width: 375px)" query-matches="{{_desktopMode}}"></iron-media-query></template><script>Polymer({is:'vaadin-date-picker-overlay',listeners:{keydown:'_onKeydown',tap:'_stopPropagation',focus:'_onOverlayFocus',blur:'_onOverlayBlur'},hostAttributes:{tabIndex:'0'},properties:{selectedDate:{type:Date,notify:!0},focusedDate:{type:Date,notify:!0,observer:'_focusedDateChanged'},_focusedMonthDate:Number,initialPosition:{type:Date,observer:'_initialPositionChanged'},_originDate:{value:new Date},_visibleMonthIndex:Number,_desktopMode:Boolean,_translateX:{observer:'_translateXChanged'},_yearScrollerWidth:{value:50},i18n:{type:Object},showWeekNumbers:{type:Boolean},_ignoreTaps:Boolean,_notTapping:Boolean,minDate:Date,maxDate:Date,_focused:Boolean},attached:function(){this._translateX=this._yearScrollerWidth,this.toggleClass('animate',!0),this.setScrollDirection('y',this.$.scrollers),Polymer.IronA11yAnnouncer.requestAvailability()},announceFocusedDate:function(){var a=this._currentlyFocusedDate(),f=[];return vaadin.elements.datepicker.DatePickerHelper._dateEquals(a,new Date)&&f.push(this.i18n.today),f=f.concat([this.i18n.weekdays[a.getDay()],a.getDate(),this.i18n.monthNames[a.getMonth()],a.getFullYear()]),this.showWeekNumbers&&1===this.i18n.firstDayOfWeek&&(f.push(this.i18n.week),f.push(vaadin.elements.datepicker.DatePickerHelper._getISOWeekNumber(a))),void this.fire('iron-announce',{text:f.join(' ')})},focusCancel:function(){this.$.cancelButton.focus()},scrollToDate:function(a,f){this._scrollToPosition(this._differenceInMonths(a,this._originDate),f)},_focusedDateChanged:function(a){this.revealDate(a)},revealDate:function(a){if(a){var f=this._differenceInMonths(a,this._originDate),g=this.$.scroller.position>f,h=this.$.scroller.clientHeight/this.$.scroller.itemHeight,j=this.$.scroller.position+h-1<f;g?this._scrollToPosition(f,!0):j&&this._scrollToPosition(f-h+1,!0)}},_onOverlayFocus:function(){this._focused=!0},_onOverlayBlur:function(){this._focused=!1},_initialPositionChanged:function(a){this.scrollToDate(a)},_repositionYearScroller:function(){this._visibleMonthIndex=Math.floor(this.$.scroller.position),this.$.yearScroller.position=(this.$.scroller.position+this._originDate.getMonth())/12},_repositionMonthScroller:function(){this.$.scroller.position=12*this.$.yearScroller.position-this._originDate.getMonth(),this._visibleMonthIndex=Math.floor(this.$.scroller.position)},_onMonthScroll:function(){this._repositionYearScroller(),this._doIgnoreTaps()},_onYearScroll:function(){this._repositionMonthScroller(),this._doIgnoreTaps()},_onYearScrollTouchStart:function(){this._notTapping=!1,this.async(function(){this._notTapping=!0},300),this._repositionMonthScroller()},_onMonthScrollTouchStart:function(){this._repositionYearScroller()},_doIgnoreTaps:function(){this._ignoreTaps=!0,this.debounce('restore-taps',function(){this._ignoreTaps=!1},300)},_formatDisplayed:function(a,f){if(a)return f(a)},_onTodayTap:function(){var a=new Date;this.$.scroller.position===this._differenceInMonths(a,this._originDate)?(this.selectedDate=a,this._close()):this._scrollToCurrentMonth()},_scrollToCurrentMonth:function(){this.focusedDate&&(this.focusedDate=new Date),this.scrollToDate(new Date,!0)},_showClear:function(a){return null!==a},_onYearTap:function(a){if(!this._ignoreTaps&&!this._notTapping){var f=a.detail.y-(this.$.yearScroller.getBoundingClientRect().top+this.$.yearScroller.clientHeight/2),g=f/this.$.yearScroller.itemHeight;this._scrollToPosition(this.$.scroller.position+12*g,!0)}},_scrollToPosition:function(a,f){if(void 0!==this._targetPosition)return void(this._targetPosition=a);if(!f)return this.$.scroller.position=a,this._targetPosition=void 0,void this._repositionYearScroller();this._targetPosition=a;var g=function(n,o,p,q){return(n/=q/2,1>n)?p/2*n*n+o:(n--,-p/2*(n*(n-2)-1)+o)},h=f?300:0,j=0,l=this.$.scroller.position,m=function(n){j=j||n;var o=n-j;if(o<h){var p=g(o,l,this._targetPosition-l,h);this.$.scroller.position=p,window.requestAnimationFrame(m)}else this.fire('scroll-animation-finished',{position:this._targetPosition,oldPosition:l}),this.$.scroller.position=this._targetPosition,this._targetPosition=void 0;this.async(this._repositionYearScroller,1)}.bind(this);window.requestAnimationFrame(m)},_limit:function(a,f){return Math.min(f.max,Math.max(f.min,a))},_handleTrack:function(a){if(!(10>Math.abs(a.detail.dx)||10<Math.abs(a.detail.ddy))){Math.abs(a.detail.ddx)>this._yearScrollerWidth/3&&this.toggleClass('animate',!0);var f=this._translateX+a.detail.ddx;this._translateX=this._limit(f,{min:0,max:this._yearScrollerWidth})}},_track:function(a){if(!this._desktopMode)switch(a.detail.state){case'start':this.toggleClass('animate',!1);break;case'track':this._handleTrack(a);break;case'end':this.toggleClass('animate',!0),this._translateX>=this._yearScrollerWidth/2?this._closeYearScroller():this._openYearScroller();}},_toggleYearScroller:function(){this._isYearScrollerVisible()?this._closeYearScroller():this._openYearScroller()},_openYearScroller:function(){this._translateX=0},_closeYearScroller:function(){this._translateX=this._yearScrollerWidth},_isYearScrollerVisible:function(){return this._translateX<this._yearScrollerWidth/2},_translateXChanged:function(a){this._desktopMode||(this.transform('translateX('+(a-this._yearScrollerWidth)+'px)',this.$.scroller),this.transform('translateX('+a+'px)',this.$.yearScroller),this.transform('translateX('+-a+'px)',this.$.fade))},_yearAfterXYears:function(a){var f=new Date(this._originDate);return f.setFullYear(parseInt(a)+this._originDate.getFullYear()),f.getFullYear()},_yearAfterXMonths:function(a){return this._dateAfterXMonths(a).getFullYear()},_dateAfterXMonths:function(a){var f=new Date(this._originDate);return f.setDate(1),f.setMonth(parseInt(a)+this._originDate.getMonth()),f},_differenceInMonths:function(a,f){var g=12*(a.getFullYear()-f.getFullYear());return g-f.getMonth()+a.getMonth()},_differenceInYears:function(a,f){return this._differenceInMonths(a,f)/12},_clear:function(){this.selectedDate='',this._close()},_close:function(){this.fire('close')},_cancel:function(){this.focusedDate=this.selectedDate,this._close()},_preventDefault:function(a){a.preventDefault()},_eventKey:function(a){for(var h,f=['down','up','right','left','enter','space','home','end','pageup','pagedown','tab'],g=0;g<f.length;g++)if(h=f[g],Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(a,h))return h},_onKeydown:function(a){var f=this._currentlyFocusedDate(),g=this._eventKey(a);if('tab'===g)a.stopPropagation(),this.hasAttribute('fullscreen')?a.preventDefault():this.$.cancelButton.focused&&!a.shiftKey||this._focused&&a.shiftKey?(a.preventDefault(),this.fire('focus-input')):this.async(function(){this._focused&&this.revealDate(this.focusedDate)},1);else if(g)switch(a.preventDefault(),a.stopPropagation(),g){case'down':this._moveFocusByDays(7),this.focus();break;case'up':this._moveFocusByDays(-7),this.focus();break;case'right':this._buttonFocused()||this._moveFocusByDays(1);break;case'left':this._buttonFocused()||this._moveFocusByDays(-1);break;case'enter':this._buttonFocused()||this._close();break;case'space':var h=this.focusedDate;vaadin.elements.datepicker.DatePickerHelper._dateEquals(h,this.selectedDate)?(this.selectedDate='',this.focusedDate=h):this.selectedDate=h;break;case'home':this._moveFocusInsideMonth(f,'minDate');break;case'end':this._moveFocusInsideMonth(f,'maxDate');break;case'pagedown':this._moveFocusByMonths(a.shiftKey?12:1);break;case'pageup':this._moveFocusByMonths(a.shiftKey?-12:-1);}},_buttonFocused:function(){return this.$.todayButton.focused||this.$.cancelButton.focused},_currentlyFocusedDate:function(){return this.focusedDate||this.selectedDate||this.initialPosition||new Date},_moveFocusByDays:function(a){var f=this._currentlyFocusedDate(),g=new Date(0,0);g.setFullYear(f.getFullYear()),g.setMonth(f.getMonth()),g.setDate(f.getDate()+a),this._dateAllowed(g,this.minDate,this.maxDate)?(this.focusedDate=g,this._focusedMonthDate=this.focusedDate.getDate()):this._dateAllowed(f,this.minDate,this.maxDate)?0<a?(this.focusedDate=this.maxDate,this._focusedMonthDate=this.maxDate.getDate()):(this.focusedDate=this.minDate,this._focusedMonthDate=this.minDate.getDate()):(this.focusedDate=vaadin.elements.datepicker.DatePickerHelper._getClosestDate(f,[this.minDate,this.maxDate]),this._focusedMonthDate=this.focusedDate.getDate())},_moveFocusByMonths:function(a){var f=this._currentlyFocusedDate(),g=new Date(0,0);g.setFullYear(f.getFullYear()),g.setMonth(f.getMonth()+a);var h=g.getMonth();g.setDate(this._focusedMonthDate||(this._focusedMonthDate=f.getDate())),g.getMonth()!==h&&g.setDate(0),this._dateAllowed(g,this.minDate,this.maxDate)?this.focusedDate=g:this._dateAllowed(f,this.minDate,this.maxDate)?0<a?(this.focusedDate=this.maxDate,this._focusedMonthDate=this.maxDate.getDate()):(this.focusedDate=this.minDate,this._focusedMonthDate=this.minDate.getDate()):(this.focusedDate=vaadin.elements.datepicker.DatePickerHelper._getClosestDate(f,[this.minDate,this.maxDate]),this._focusedMonthDate=this.focusedDate.getDate())},_moveFocusInsideMonth:function(a,f){var g=new Date(0,0);g.setFullYear(a.getFullYear()),'minDate'===f?(g.setMonth(a.getMonth()),g.setDate(1)):(g.setMonth(a.getMonth()+1),g.setDate(0)),this._dateAllowed(g,this.minDate,this.maxDate)?(this.focusedDate=g,this._focusedMonthDate=this.focusedDate.getDate()):this._dateAllowed(a,this.minDate,this.maxDate)?(this.focusedDate=this[f],this._focusedMonthDate=this[f].getDate()):(this.focusedDate=vaadin.elements.datepicker.DatePickerHelper._getClosestDate(a,[this.minDate,this.maxDate]),this._focusedMonthDate=this.focusedDate.getDate())},_dateAllowed:function(a,f,g){return(!f||a>=f)&&(!g||a<=g)},_isTodayAllowed:function(a,f){var g=new Date,h=new Date(0,0);return h.setFullYear(g.getFullYear()),h.setMonth(g.getMonth()),h.setDate(g.getDate()),this._dateAllowed(h,a,f)},_stopPropagation:function(a){a.stopPropagation()}});</script></dom-module></body></html>
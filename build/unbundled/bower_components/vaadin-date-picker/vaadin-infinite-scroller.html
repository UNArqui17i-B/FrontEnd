<html><head><link rel="import" href="../polymer/polymer.html"></head><body><dom-module id="vaadin-infinite-scroller"><template><style>:host{display:block;overflow:hidden;height:500px;}#scroller{position:relative;height:100%;overflow:auto;outline:none;margin-right:-40px;-webkit-overflow-scrolling:touch;-ms-overflow-style:none;overflow-x:hidden;}#scroller.notouchscroll{-webkit-overflow-scrolling:auto;}#scroller::-webkit-scrollbar{display:none;}.buffer{position:absolute;width:100%;box-sizing:border-box;padding-right:40px;@apply (--vaadin-infinite-scroller-buffer);}:host(:not([init-animation-done])) .buffer > *{animation:fadein 0.2s;}@keyframes fadein{from{opacity:0;}to{opacity:1;}}</style><div id="scroller"><div class="buffer"></div><div class="buffer"></div><div id="fullHeight"></div></div></template></dom-module><script>Polymer({is:'vaadin-infinite-scroller',behaviors:[Polymer.Templatizer],properties:{itemHeight:{type:Number,value:50},bufferSize:{type:Number,value:20},_initialScroll:{value:5e5},_initialIndex:{value:0},_buffers:Array,_preventScrollEvent:Boolean,_bufferHeight:Number,_mayHaveMomentum:Boolean,_initialized:Boolean,active:Boolean},observers:['_activated(active)'],_activated:function(a){a&&!this._initialized&&(this._createPool(),this._initialized=!0)},listeners:{animationend:'_animationEnd'},_animationEnd:function(){this.toggleAttribute('init-animation-done',!0)},_finishInit:function(){this._initDone||(this._buffers.forEach(function(a){[].forEach.call(a.children,function(b){this._ensureStampedInstance(b)}.bind(this))},this),!this._buffers[0].translateY&&this._reset(),this._initDone=!0)},ready:function(){this._bufferHeight=this.itemHeight*this.bufferSize,this._buffers=Polymer.dom(this.root).querySelectorAll('.buffer'),this.$.fullHeight.style.height=2*this._initialScroll+'px';var a=Polymer.dom(this).querySelector('template');this.templatize(a);var b=-1<navigator.userAgent.toLowerCase().indexOf('firefox');b&&(this.$.scroller.tabIndex=-1)},_translateBuffer:function(a){var b=a?1:0;this._buffers[b].translateY=this._buffers[b?0:1].translateY+this._bufferHeight*(b?-1:1),this.transform('translate3d(0, '+this._buffers[b].translateY+'px, 0)',this._buffers[b]),this._buffers[b].updated=!1,this._buffers.reverse()},_scroll:function(){var a=this.$.scroller.scrollTop;(a<this._bufferHeight||a>2*this._initialScroll-this._bufferHeight)&&(this._initialIndex=~~this.position,this._reset());var b=this.$$('.buffer').offsetTop,c=a>this._buffers[1].translateY+this.itemHeight+b,d=a<this._buffers[0].translateY+this.itemHeight+b;(c||d)&&(this._translateBuffer(d),this._updateClones()),this._preventScrollEvent||(this.fire('custom-scroll',void 0,{bubbles:!1}),this._mayHaveMomentum=!0),this._preventScrollEvent=!1,this.debounce('scrollFinish',function(){var e=this.$.scroller.getBoundingClientRect();this._isVisible(this._buffers[0],e)||this._isVisible(this._buffers[1],e)||(this.position=this.position)},200)},set position(a){this._preventScrollEvent=!0,a>this._firstIndex&&a<this._firstIndex+2*this.bufferSize?this.$.scroller.scrollTop=this.itemHeight*(a-this._firstIndex)+this._buffers[0].translateY:(this._initialIndex=~~a,this._reset(),this.unlisten(this.$.scroller,'scroll','_scroll'),this.$.scroller.scrollTop+=a%1*this.itemHeight,this.listen(this.$.scroller,'scroll','_scroll')),this._mayHaveMomentum&&(this.$.scroller.classList.add('notouchscroll'),this._mayHaveMomentum=!1,this.async(function(){this.$.scroller.classList.remove('notouchscroll')},10))},get position(){return(this.$.scroller.scrollTop-this._buffers[0].translateY)/this.itemHeight+this._firstIndex},_reset:function(){this.unlisten(this.$.scroller,'scroll','_scroll'),this.$.scroller.scrollTop=this._initialScroll,this._buffers[0].translateY=this._initialScroll-this._bufferHeight,this._buffers[1].translateY=this._initialScroll,this._buffers.forEach(function(a){Polymer.Base.transform('translate3d(0, '+a.translateY+'px, 0)',a)}),this._buffers[0].updated=this._buffers[1].updated=!1,this._updateClones(!0),this.debounce('updateAllClones',function(){this._buffers[0].updated=this._buffers[1].updated=!1,this._updateClones()},200),this.listen(this.$.scroller,'scroll','_scroll')},_createPool:function(){var a=this.getBoundingClientRect();this._buffers.forEach(function(b){for(var d,c=0;c<this.bufferSize;c++)d=document.createElement('div'),d.style.height=this.itemHeight+'px',d.instance={},Polymer.dom(b).appendChild(d),this.async(function(e,f){this._isVisible(e,f)&&this._ensureStampedInstance(e)}.bind(this,d,a),1),Polymer.RenderStatus.afterNextRender(d,this._finishInit.bind(this))},this)},_ensureStampedInstance:function(a){if(!a.firstElementChild){var b=a.instance;a.instance=this.stamp({}),Polymer.dom(a).appendChild(a.instance.root),Object.keys(b).forEach(function(c){a.instance[c]=b[c]})}},_updateClones:function(a){this._firstIndex=~~((this._buffers[0].translateY-this._initialScroll)/this.itemHeight)+this._initialIndex;var b=a?this.$.scroller.getBoundingClientRect():void 0;this._buffers.forEach(function(c,d){if(!c.updated){var e=this._firstIndex+this.bufferSize*d;[].forEach.call(c.children,function(f,g){(!a||this._isVisible(f,b))&&(f.instance.index=e+g)}.bind(this)),c.updated=!0}},this)},_isVisible:function(a,b){var c=a.getBoundingClientRect();return c.bottom>b.top&&c.top<b.bottom},_forwardParentProp:function(a,b){'index'!==a&&this._buffers.forEach(function(c){[].forEach.call(c.children,function(d){d.instance[a]=b})})},_forwardParentPath:function(a,b){'index'!==a&&this._buffers.forEach(function(c){[].forEach.call(c.children,function(d){d.instance.notifyPath(a,b,!0)})})}});</script></body></html>